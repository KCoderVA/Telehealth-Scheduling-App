<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kyle's Development Activity Dashboard - Telehealth Resources Project</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .controls {
      background: #f8f9fa;
      padding: 25px;
      border-bottom: 2px solid #e9ecef;
    }

    .control-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .control-item {
      display: flex;
      flex-direction: column;
    }

    .control-item label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #2c3e50;
    }

    .control-item input,
    .control-item select {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .control-item input:focus,
    .control-item select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .results {
      padding: 30px;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .card h3 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .card p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .card.commits {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .card.files {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .card.lines {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .card.productivity {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #2c3e50;
    }

    .detailed-section {
      margin-top: 30px;
    }

    .section-title {
      font-size: 1.5rem;
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }

    .commit-item {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      margin-bottom: 15px;
      padding: 20px;
      border-radius: 0 8px 8px 0;
    }

    .commit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .commit-hash {
      background: #667eea;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-family: monospace;
    }

    .commit-date {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .commit-message {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .commit-stats {
      font-size: 0.9rem;
      color: #28a745;
    }

    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.2rem;
      color: #6c757d;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }

    .note {
      background: #d1ecf1;
      color: #0c5460;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .control-group {
        grid-template-columns: 1fr;
      }

      .button-group {
        flex-direction: column;
      }

      .summary-cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Kyle's Development Dashboard</h1>
      <p>Telehealth Resources Project - Real-time Git Activity Report</p>
      <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">
        Last Updated: <span id="lastUpdate"></span>
      </p>
    </div>

    <div class="controls">
      <div class="control-group">
        <div class="control-item">
          <label for="startDate">Start Date:</label>
          <input type="date" id="startDate" value="">
        </div>
        <div class="control-item">
          <label for="endDate">End Date:</label>
          <input type="date" id="endDate" value="">
        </div>
        <div class="control-item">
          <label for="reportType">Report Type:</label>
          <select id="reportType">
            <option value="summary">Summary Only</option>
            <option value="detailed">Detailed View</option>
            <option value="both" selected>Both Summary & Details</option>
          </select>
        </div>
        <div class="control-item">
          <label for="quickSelect">Quick Select:</label>
          <select id="quickSelect">
            <option value="">Custom Range</option>
            <option value="today">Today</option>
            <option value="yesterday">Yesterday</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="lastweek">Last Week</option>
            <option value="lastmonth">Last Month</option>
          </select>
        </div>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="generateReport()">
          üìä Generate Report
        </button>
        <button class="btn btn-secondary" onclick="exportReport()">
          üìÅ Export to File
        </button>
        <button class="btn btn-secondary" onclick="refreshData()">
          üîÑ Refresh Data
        </button>
      </div>

      <div class="note">
        <strong>üìç Instructions:</strong> Select date range and report type, then click "Generate Report".
        This dashboard automatically reads from the local git repository to show Kyle's development activity.
        <br><strong>Repository Path:</strong> <span id="repoPath"></span>
      </div>
    </div>

    <div class="results" id="results">
      <div class="loading">
        üëã Welcome! Select a date range and click "Generate Report" to view Kyle's development activity.
      </div>
    </div>
  </div>

  <!-- Include the API bridge -->
  <script src="git-dashboard-api.js"></script>

  <script>
    // Set default dates
    document.addEventListener('DOMContentLoaded', function () {
      const today = new Date().toISOString().split('T')[0];
      const lastWeek = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

      document.getElementById('startDate').value = lastWeek;
      document.getElementById('endDate').value = today;
      document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
      document.getElementById('repoPath').textContent = window.location.pathname.replace('/git-activity-dashboard.html', '') + '/.git/';
    });

    // Quick select handler
    document.getElementById('quickSelect').addEventListener('change', function () {
      const value = this.value;
      const today = new Date();
      let startDate, endDate;

      switch (value) {
        case 'today':
          startDate = endDate = today.toISOString().split('T')[0];
          break;
        case 'yesterday':
          const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);
          startDate = endDate = yesterday.toISOString().split('T')[0];
          break;
        case 'week':
          const weekStart = new Date(today.getTime() - (today.getDay() * 24 * 60 * 60 * 1000));
          startDate = weekStart.toISOString().split('T')[0];
          endDate = today.toISOString().split('T')[0];
          break;
        case 'month':
          startDate = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
          endDate = today.toISOString().split('T')[0];
          break;
        case 'lastweek':
          const lastWeekEnd = new Date(today.getTime() - (today.getDay() * 24 * 60 * 60 * 1000));
          const lastWeekStart = new Date(lastWeekEnd.getTime() - (6 * 24 * 60 * 60 * 1000));
          startDate = lastWeekStart.toISOString().split('T')[0];
          endDate = lastWeekEnd.toISOString().split('T')[0];
          break;
        case 'lastmonth':
          const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
          const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
          startDate = lastMonth.toISOString().split('T')[0];
          endDate = lastMonthEnd.toISOString().split('T')[0];
          break;
      }

      if (startDate && endDate) {
        document.getElementById('startDate').value = startDate;
        document.getElementById('endDate').value = endDate;
      }
    });

    // Generate report using real git data
    async function generateReport() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const reportType = document.getElementById('reportType').value;

      if (!startDate || !endDate) {
        showError('Please select both start and end dates.');
        return;
      }

      showLoading();

      try {
        // Use the GitActivityAPI to get real data
        const data = await window.gitAPI.refreshData(startDate, endDate);
        displayResults(data, reportType);
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
      } catch (error) {
        console.error('Error generating report:', error);
        showError('Failed to generate report. Please ensure PowerShell script is accessible.');
      }
    }

    // Updated getGitData function to use real API
    function getGitData(startDate, endDate) {
      // This function is now handled by the GitActivityAPI
      // Keeping for backward compatibility
      return window.gitAPI.getDemoData();
    }

    function displayResults(data, reportType) {
      const resultsDiv = document.getElementById('results');
      let html = '';

      if (reportType === 'summary' || reportType === 'both') {
        html += generateSummaryCards(data.summary);
      }

      if (reportType === 'detailed' || reportType === 'both') {
        html += generateDetailedView(data.commits);
      }

      resultsDiv.innerHTML = html;
    }

    function generateSummaryCards(summary) {
      return `
                <div class="summary-cards">
                    <div class="card commits">
                        <h3>${summary.totalCommits}</h3>
                        <p>Total Commits</p>
                    </div>
                    <div class="card files">
                        <h3>${summary.filesChanged}</h3>
                        <p>Files Modified</p>
                    </div>
                    <div class="card lines">
                        <h3>+${summary.linesAdded.toLocaleString()}</h3>
                        <p>Lines Added</p>
                    </div>
                    <div class="card productivity">
                        <h3>${summary.productivityScore}%</h3>
                        <p>Productivity Score</p>
                    </div>
                </div>
            `;
    }

    function generateDetailedView(commits) {
      let html = `
                <div class="detailed-section">
                    <h2 class="section-title">üìù Detailed Commit History</h2>
            `;

      commits.forEach(commit => {
        html += `
                    <div class="commit-item">
                        <div class="commit-header">
                            <span class="commit-hash">${commit.hash}</span>
                            <span class="commit-date">${new Date(commit.date).toLocaleString()}</span>
                        </div>
                        <div class="commit-message">${commit.message}</div>
                        <div class="commit-stats">
                            üìÅ ${commit.filesChanged} files changed |
                            ‚úÖ +${commit.linesAdded.toLocaleString()} additions |
                            ‚ùå -${commit.linesRemoved} deletions
                        </div>
                    </div>
                `;
      });

      html += '</div>';
      return html;
    }

    function showLoading() {
      document.getElementById('results').innerHTML = `
                <div class="loading">
                    üîÑ Analyzing git repository and generating report...
                </div>
            `;
    }

    function showError(message) {
      document.getElementById('results').innerHTML = `
                <div class="error">
                    ‚ùå <strong>Error:</strong> ${message}
                </div>
            `;
    } function refreshData() {
      document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
      generateReport();
    }

    async function exportReport() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      if (!startDate || !endDate) {
        alert('‚ùå Please select date range first.');
        return;
      }

      try {
        // Get current data
        const data = await window.gitAPI.refreshData(startDate, endDate);

        // Show format selection
        const format = prompt('üìÅ Select export format:\n\n1. JSON (for data processing)\n2. CSV (for Excel)\n3. HTML (for sharing)\n\nEnter: json, csv, or html', 'html');

        if (format && ['json', 'csv', 'html'].includes(format.toLowerCase())) {
          await window.gitAPI.exportData(data, format.toLowerCase());
          alert(`‚úÖ Report exported successfully as ${format.toUpperCase()} file!`);
        } else if (format !== null) {
          alert('‚ùå Invalid format. Please choose: json, csv, or html');
        }
      } catch (error) {
        alert(`‚ùå Export failed: ${error.message}`);
      }
    }

    // Auto-refresh every 30 minutes
    setInterval(refreshData, 30 * 60 * 1000);
  </script>
</body>

</html>
