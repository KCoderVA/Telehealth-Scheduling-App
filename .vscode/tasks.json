{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Initialize Git Repository",
      "type": "shell",
      "command": "git",
      "args": ["init"],
      "group": "build"
    },
    {
      "label": "Git Add All Changes",
      "type": "shell",
      "command": "git",
      "args": ["add", "."],
      "group": "build"
    },
    {
      "label": "Git Commit with Message",
      "type": "shell",
      "command": "git",
      "args": ["commit", "-m", "${input:commitMessage}"],
      "dependsOn": "Git Add All Changes",
      "group": "build"
    },
    {
      "label": "Quick Commit and Push",
      "type": "shell",
      "command": "powershell",
      "args": ["-Command", "git add . ; git commit -m '${input:quickCommitMessage}' ; Write-Host 'Commit completed successfully!'"],
      "group": "build"
    },
    {
      "label": "ðŸ§ª Test GitHub API Connectivity",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-ExecutionPolicy",
        "Bypass",
        "-File",
        "./scripts/pwsh/test-github-connectivity.ps1",
        "-Token",
        "${input:githubToken}"
      ],
      "group": "build"
    },
    {
      "label": "ðŸ†• Intake: Create Issue",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-ExecutionPolicy","Bypass",
        "-File","./scripts/pwsh/intake-create-issue.ps1",
        "-Token","${input:githubToken}",
        "-Employee","${input:employeeName}",
        "-Email","${input:employeeEmail}",
        "-Dept","${input:employeeDept}",
        "-Phone","${input:employeePhone}",
        "-Severity","${input:issueSeverity}",
        "-Title","${input:issueTitle}",
        "-Description","${input:issueDescription}",
        "-Steps","${input:reproSteps}",
        "-Extra","${input:intakeExtra}",
        "-Screenshot","${input:screenshotPath}"
      ],
      "group": "build"
    },
    {
      "label": "ðŸ†• Intake: Close With Fix",
      "type": "shell",
      "command": "powershell",
      "args": ["-Command", "$ErrorActionPreference=\"Stop\"; $num=\"${input:closeIssueNumber}\"; $commit=\"${input:fixCommitRef}\"; $notes=\"${input:resolutionNotes}\"; $token=\"${input:githubToken}\"; if([string]::IsNullOrWhiteSpace($token)){ $token=$env:GITHUB_TOKEN }; if([string]::IsNullOrWhiteSpace($num)){ try { if([string]::IsNullOrWhiteSpace($token)){ throw 'No token for auto-detect.' }; $headersTmp=@{ Authorization='Bearer '+$token; 'User-Agent'='TelehealthIssueAutomation'; Accept='application/vnd.github+json' }; $latest=Invoke-RestMethod -Method Get -Uri 'https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues?labels=intake&state=open&per_page=1' -Headers $headersTmp; if($latest[0].number){ $num=$latest[0].number; Write-Host ('Auto-detected latest open intake issue: #' + $num) -ForegroundColor Cyan } } catch { Write-Host ('Auto-detect failed: '+$_.Exception.Message) -ForegroundColor Yellow } }; if(!$num){ Write-Host 'Issue number required.' -ForegroundColor Red; exit 2 }; $verify=(git rev-parse --verify $commit 2>$null); if(!$verify){ Write-Host ('Commit ref not found: '+$commit) -ForegroundColor Red; exit 3 }; $short=(git rev-parse --short $commit); if([string]::IsNullOrWhiteSpace($token)){ Write-Host 'ðŸ”“ No token provided; cannot close automatically.' -ForegroundColor Yellow; Write-Host ('Manual steps: open issue #'+$num+'; comment and close.') -ForegroundColor Cyan; exit 0 }; $headers=@{ Authorization='Bearer '+$token; 'User-Agent'='TelehealthIssueAutomation'; Accept='application/vnd.github+json' }; $commentBody='Fix applied in commit '+$short+' ('+$commit+').\n\nNotes: '+$notes; try { Invoke-RestMethod -Method Post -Uri ('https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues/'+$num+'/comments') -Headers $headers -Body (@{ body=$commentBody } | ConvertTo-Json); Write-Host 'ðŸ“ Comment added.' -ForegroundColor Green } catch { Write-Host ('Comment failed: '+$_.Exception.Message) -ForegroundColor Yellow }; try { Invoke-RestMethod -Method Post -Uri ('https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues/'+$num+'/labels') -Headers $headers -Body (@{ labels=@('fixed') } | ConvertTo-Json) | Out-Null; Write-Host 'ðŸ·ï¸ Label applied: fixed' -ForegroundColor Green } catch { Write-Host ('Label failed: '+$_.Exception.Message) -ForegroundColor Yellow }; try { $clResp=Invoke-RestMethod -Method Patch -Uri ('https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues/'+$num) -Headers $headers -Body (@{ state='closed' } | ConvertTo-Json); if($clResp.state -eq 'closed'){ Write-Host ('âœ… Issue #'+$num+' closed.') -ForegroundColor Green } else { Write-Host 'âŒ Issue did not close.' -ForegroundColor Red } } catch { Write-Host ('Close failed: '+$_.Exception.Message) -ForegroundColor Red }"],
      "group": "build"
    },
    {
      "label": "âš¡ Intake: Auto-Close Latest",
      "type": "shell",
      "command": "powershell",
      "args": ["-Command", "$ErrorActionPreference=\"Stop\"; $token=\"${input:githubToken}\"; if([string]::IsNullOrWhiteSpace($token)){ $token=$env:GITHUB_TOKEN }; if([string]::IsNullOrWhiteSpace($token)){ Write-Host 'Token required.' -ForegroundColor Red; exit 1 }; $commit=\"${input:fixCommitRef}\"; $notes=\"${input:resolutionNotes}\"; $verify=(git rev-parse --verify $commit 2>$null); if(!$verify){ Write-Host ('Commit ref not found: '+$commit) -ForegroundColor Red; exit 2 }; $short=(git rev-parse --short $commit); $headers=@{ Authorization='Bearer '+$token; 'User-Agent'='TelehealthIssueAutomation'; Accept='application/vnd.github+json' }; try { $latest=Invoke-RestMethod -Method Get -Uri 'https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues?labels=intake&state=open&per_page=1' -Headers $headers; if(!$latest[0].number){ Write-Host 'No open intake issues found.' -ForegroundColor Yellow; exit 0 }; $num=$latest[0].number; Write-Host ('Targeting latest intake issue #' + $num) -ForegroundColor Cyan } catch { Write-Host ('Fetch failed: '+$_.Exception.Message) -ForegroundColor Red; exit 3 }; $commentBody='Fix applied in commit '+$short+' ('+$commit+').\n\nNotes: '+$notes; try { Invoke-RestMethod -Method Post -Uri ('https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues/'+$num+'/comments') -Headers $headers -Body (@{ body=$commentBody } | ConvertTo-Json) | Out-Null; Write-Host 'ðŸ“ Comment added.' -ForegroundColor Green } catch { Write-Host ('Comment failed: '+$_.Exception.Message) -ForegroundColor Yellow }; try { Invoke-RestMethod -Method Post -Uri ('https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues/'+$num+'/labels') -Headers $headers -Body (@{ labels=@('fixed') } | ConvertTo-Json) | Out-Null; Write-Host 'ðŸ·ï¸ Label applied.' -ForegroundColor Green } catch { Write-Host ('Label failed: '+$_.Exception.Message) -ForegroundColor Yellow }; try { $clResp=Invoke-RestMethod -Method Patch -Uri ('https://api.github.com/repos/KCoderVA/Telehealth-Scheduling-App/issues/'+$num) -Headers $headers -Body (@{ state='closed' } | ConvertTo-Json); if($clResp.state -eq 'closed'){ Write-Host ('âœ… Closed issue #' + $num) -ForegroundColor Green } else { Write-Host 'âŒ Issue not closed.' -ForegroundColor Red } } catch { Write-Host ('Close failed: '+$_.Exception.Message) -ForegroundColor Red }"],
      "group": "build"
    },
    {
      "label": "ðŸ“˜ Intake: Lifecycle Helper",
      "type": "shell",
      "command": "powershell",
      "args": ["-Command", "Write-Host '1) Run ðŸ†• Intake: Create Issue (blank token -> browser).' -ForegroundColor Cyan; Write-Host '2) Fix & commit (include issue # in message).' -ForegroundColor Cyan; Write-Host '3) Run ðŸ†• Intake: Close With Fix OR âš¡ Auto-Close Latest.' -ForegroundColor Cyan; Write-Host 'Optional: set $env:GITHUB_TOKEN to skip token prompt.' -ForegroundColor Yellow"],
      "group": "build"
    },
    {
      "label": "ðŸ§ª Test: Intake E2E (Full)",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-ExecutionPolicy",
        "Bypass",
        "-File",
        "./scripts/pwsh/test-intake-e2e.ps1",
        "-Token",
        "${input:githubToken}",
        "-VerboseOutput"
      ],
      "group": "test"
    },
    {
      "label": "ðŸ§ª Test: Intake E2E (Dry Run)",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-ExecutionPolicy",
        "Bypass",
        "-File",
        "./scripts/pwsh/test-intake-e2e.ps1",
        "-SkipIssueCreation",
        "-CleanupAfterTest",
        "-VerboseOutput"
      ],
      "group": "test"
    },
    {
      "label": "ðŸ§ª Test: Intake E2E (With Cleanup)",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-ExecutionPolicy",
        "Bypass",
        "-File",
        "./scripts/pwsh/test-intake-e2e.ps1",
        "-Token",
        "${input:githubToken}",
        "-CleanupAfterTest",
        "-VerboseOutput"
      ],
      "group": "test"
    }
  ],
  "inputs": [
    {"id": "commitMessage", "description": "Enter detailed commit message", "default": "Update project files", "type": "promptString"},
    {"id": "quickCommitMessage", "description": "Enter quick commit message", "default": "Quick save progress", "type": "promptString"},
    {"id": "employeeName", "description": "Employee full name (verbal intake)", "default": "John Doe", "type": "promptString"},
    {"id": "employeeEmail", "description": "Employee email (optional)", "default": "", "type": "promptString"},
    {"id": "employeeDept", "description": "Department / Service Line", "default": "Telehealth", "type": "promptString"},
    {"id": "employeePhone", "description": "Phone or extension (optional)", "default": "", "type": "promptString"},
    {"id": "issueSeverity", "description": "Severity (low|moderate|high|critical)", "default": "moderate", "type": "promptString"},
    {"id": "issueTitle", "description": "Short issue title", "default": "Room booking fails on submit", "type": "promptString"},
    {"id": "issueDescription", "description": "Detailed description / quoted complaint", "default": "User reports submit button unresponsive after selecting room.", "type": "promptString"},
    {"id": "reproSteps", "description": "Condensed reproduction steps", "default": "Open app â†’ Select Building A â†’ Pick Room 102 â†’ Click Submit", "type": "promptString"},
    {"id": "screenshotPath", "description": "Local path to screenshot (optional)", "default": "", "type": "promptString"},
    {"id": "intakeExtra", "description": "Additional notes / context", "default": "Reported during morning clinic", "type": "promptString"},
    {"id": "closeIssueNumber", "description": "Issue number to close (omit #; blank attempts auto-detect)", "default": "", "type": "promptString"},
    {"id": "fixCommitRef", "description": "Commit hash or ref containing fix", "default": "HEAD", "type": "promptString"},
    {"id": "resolutionNotes", "description": "Closure / resolution notes", "default": "Adjusted validation logic; submit now proceeds.", "type": "promptString"},
    {"id": "githubToken", "description": "GitHub PAT (optional; or use $env:GITHUB_TOKEN)", "default": "", "type": "promptString"}
  ]
}
